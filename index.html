<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Temperature</title>

</head>

<body>
    

    <script src="reflect.js"></script>
    <script src="nodeHandling.js"></script>
    <script type="text/javascript">

var TimeOutError = function (message) {
    this.name = 'TimeOutError';
    this.message = (message || '');
};

TimeOutError.prototype = new Error();
TimeOutError.prototype.constructor = TimeOutError;

////////

var FunctionNotFoundError = function (message) {
    this.name = 'FunctionNotFoundError';
    this.message = (message || '');
};

FunctionNotFoundError.prototype = new Error();
FunctionNotFoundError.prototype.constructor = FunctionNotFoundError;

////////

var ExpectedNumberError = function (message) {
    this.name = 'ExpectedNumberError';
    this.message = (message || '');
};

ExpectedNumberError.prototype = new Error();
ExpectedNumberError.prototype.constructor = ExpectedNumberError;


        var RPC = function(){
            this.a=1;
            console.log('new RPC')
        };

RPC.prototype.rpcCall = function(func, argArr, cb, due){
    this.a++;
    due =500;
    var dueTimeout = setTimeout(function(){
        clearTimeout(cbTimeout);
        var err= new TimeOutError();
        cb(err);
    }, due);

    var cbTimeout = setTimeout(function(){
        clearTimeout(dueTimeout);
        var celcius = argArr[0];
        
        //APPLICATION CODE
        var fahrenheit = convert(celcius);
        if(fahrenheit){
            cb(null, fahrenheit);
        }else{ //NaN
            var err = new ExpectedNumberError('\'' + celcius + '\' is not a number.');
            cb(err);
        }
        //APPLICATION CODE

    }, Math.floor((Math.random() * 1000) + 1));
    return func;
};

// Actual application code...
//APPLICATION CODE
{
    var convert = function(celcius){
        return celcius * factor() + add;
    };

    var factor = function () {
        return 9 / 5;
    };
    var add = 32;

}
//APPLICATION CODE

var localVariable = 42;

var r = new RPC();



var handleContextual = function(){
    console.log('inside contextual, ', localVariable);
    localVariable++;
};

var a = makeFailureProxy(r, new LeafA());//, handleContextual);
var b = makeFailureProxy(r,  new LeafB()); 


var counter = 5;




////////////////////////////////////////////////////////////
/*var makeTop = function(top){
    var f = new AObj();
    f.__proto__ = top;
    return f;
};*/

/*var AObj = function(ctext){
    this.a=0;
    this.ctext = ctext;
    //this.contextObject=ctext;
    
};
AObj.prototype = {ctext:true}

AObj.prototype.afunc = function(){ 
    this.a++;
    console.log(this.contextObject)
    return 'a';}



var BObj = function(ctext){
    AObj.call(this, ctext);
    this.ctext = ctext;
};
BObj.prototype = Object.create(AObj.prototype);
BObj.prototype.afunc = function(){ 
    console.log(Object.getPrototypeOf(this).afunc());//.afunc();
    //console.log(this.contextObject)
    return 'b';
}
BObj.prototype.bfunc = function(){ return 'b';}



var CObj = function(ctext){
    BObj.call(this, ctext);
    this.ctext = ctext;
};
CObj.prototype = Object.create(BObj.prototype);
CObj.prototype.afunc = function(){ 
    Object.getPrototypeOf(this.constructor.prototype).afunc();
    console.log(this.contextObject)
    return 'c';}
CObj.prototype.bfunc = function(){ return 'c';}
CObj.prototype.cfunc = function(){ return 'c';}


function Context (counter){
    this.counter=counter;
}
Context.prototype.inc = function(){
    this.counter++;
}

var aContext = new Context(1);
var bContext = new Context(1);

var atest = new AObj(aContext);
/*console.log(atest.afunc());
console.log('---');
var btest = new BObj(bContext);
console.log(btest.afunc());
console.log('---');
var ctest = new CObj({ccc:1});
//console.log(ctest.afunc());*/

////////////////////////////////////////////////////////////


    </script>
</body>
</html>